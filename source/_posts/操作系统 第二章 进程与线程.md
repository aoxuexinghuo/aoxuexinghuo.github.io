---
title: 操作系统 第二章 进程与线程
date: 2025-03-27 15:38:38
category: 操作系统
tags:
  - 操作系统
  - 408
cover: https://bu.dusays.com/2025/03/23/67dffa6e3a768.jpeg
series: OS
---

> **🚥操作系统 系列文章导航🚥**
>
> {% series OS %}

## 一、进程与线程

### 1.进程的概念与特征

- **程序**：是静态的，就是个存放在磁盘里的可执行文件，就是一系列的指令集合。
- **进程（Process）**：是动态的，是程序的一次执行过程（同一个程序多次执行会对应多个进程）。

> **注意**：一个进程可以执行一个或几个程序，一个程序也可构成多个进程。

相比于程序，进程拥有以下特征：

- **动态性**：进程是程序的一次执行过程，是动态地产生、变化和消亡的。动态性是进程**最基本**的特征。
- **并发性**：内存中有多个进程实体，各进程可并发执行。
- **独立性**：进程是能独立运行、独立获得资源、独立接受调度的基本单位。
- **异步性**：各进程按各自独立的、不可预知的速度向前推进，操作系统要提供 “进程同步机制” 来解决异步问题。
- **结构性**：每个进程都会配置一个 PCB。结构上看，进程由程序段、数据段、PCB 组成。

### 2.进程的组成

进程是一个独立的运行单位，也是操作系统进行**资源分配**和**调度**的**基本单位**。它由进程控制块（PCB）、程序段、数据段三部分组成。其中最核心的部分是 PCB，它是进程实体的一部分，是进程存在的**唯一标志**。

PCB 是给操作系统用的数据结构；程序段、数据段是给进程自己用的，与进程自身的运行逻辑有关。

**（1）进程控制块**

PCB 主要包括以下几部分内容：

- **进程描述信息**：进程被创建时，操作系统会为该进程分配一个唯一的、不重复的 PID；UID 用于标识进程所归属的用户，为共享和保护服务。
- **进程控制和管理信息**
- **资源分配清单**：
- **处理机相关信息**：也称 CPU 上下文，主要指 CPU 中各寄存器的值。用于实现进程切换。

|   进程描述信息    | 进程控制和管理信息 | 资源分配清单 | 处理机相关信息 |
| :---------------: | :----------------: | :----------: | :------------: |
| 进程标识符（PID） |    进程当前状态    |  代码段指针  |  通用寄存器值  |
| 用户标识符（UID） |     进程优先级     |  数据段指针  |  地址寄存器值  |
|                   |  代码运行入口地址  |  堆栈段指针  |  控制寄存器值  |
|                   |   程序的外存地址   |  文件描述符  |  标志寄存器值  |
|                   |    进入内存时间    |     键盘     |     状态字     |
|                   |    CPU 占用时间    |     鼠标     |                |
|                   |     信号量使用     |              |                |

**（2）程序段**：能够被进程调度程序调度到 CPU 执行的程序代码段。

**（3）数据段**：一个进程的数据段，可以是进程对应的程序加工处理原始数据，也可以是程序执行时产生的中间或最终结果。

### 3.进程的状态与转换

通常进程有以下 5 种状态，前 3 种是进程的基本状态：

- **运行态**：进程正在 CPU 上运行。在单 CPU 中，每个时刻只有一个进程处于运行态。
- **就绪态**：进程获得了除 CPU 外的一切所需资源，一旦得到 CPU，便可立即运行。系统中处于就绪态的进程可能有多个，通常将它们排成一个队列，称为**就绪队列**。
- **阻塞态**：也称**等待态**。进程正在等待某一事件而暂停运行。系统通常将处于阻塞态的进程也排成一个队列，甚至根据阻塞原因的不同，设置多个**阻塞队列**。
- **创建态**：进程正在被创建，尚未转到就绪态。
- **终止态**：进程需要结束运行时，系统首先将该进程设置为终止态。然后进一步处理资源释放和回收等工作。

**进程状态的转换**：

![image-20250327205036150](https://bu.dusays.com/2025/03/27/67e549dc454bf.png)

在一个系统中，通常存在着许多进程的 PCB，有的处于就绪态，有的处于阻塞态，而且阻塞的原因各不相同。为了方便进程的调度和管理，需要将各个进程的 PCB 用适当的方法组织起来。目前，常用的组织方式有**链接方式**和**索引方式**两种。

**链接方式**：将同一状态的 PCB 链接成一个队列，不同状态对应不同的队列，也可将处于阻塞态的进程的 PCB，根据其阻塞原因的不同，排成多个阻塞队列。

<img src="https://bu.dusays.com/2025/03/27/67e54e288413a.png" alt="image-20250327210511610" style="zoom:67%;" />

**索引方式**：将同一状态的进程组织在一个索引表中，索引表的表项指向相应的 PCB，不同状态对应不同的索引表。

<img src="https://bu.dusays.com/2025/03/27/67e54e2bc6017.png" alt="image-20250327210604082" style="zoom:67%;" />

### 4.进程控制

**进程控制**的主要功能是对系统中的进程实施有效的管理，具有创建新进程、撤销已有进程、实现进程状态转换等功能。

在操作系统中，一般将进程控制用的程序段称为**原语**，原语可以用**关中断指令**和**开中断指令**这两个**特权指令**实现原子性。

#### （1）进程的创建

允许一个进程创建另一个进程，此时创建者为**父进程**，被创建的进程称为**子进程**。子进程可以继承父进程所拥有的资源。当子进程终止时，应将其从父进程那里获得的资源还给父进程。

引起进程创建的事件：

- 终端用户登录系统：分时系统中，用户登录成功，系统会为其建立一个新进程。
- 作业调度：多道批处理系统中，有新的作业放入内存时，会为其建立一个新的进程。
- 系统提供服务：用户向操作系统提出某些请求时，会新建一个进程处理该请求。
- 用户程序的应用请求：由用户进程主动请求创建一个子进程。

**创建原语**：创建态 -> 就绪态

1. 为新进程分配一个唯一的 PID，并申请一个空白的 PCB（PCB 是有限的）。若 PCB 申请失败，则创建失败。
2. 为新进程分配所需资源。这些资源或从操作系统获得，或仅从其父进程获得。
3. 初始化 PCB。
4. 若进程就绪队列能够接纳新进程，则将新进程插入就绪队列，等待被调度运行。

#### （2）进程的终止

引起进程终止的事件：

- 正常结束：表示进程的任务已完成并准备退出运行。
- 异常结束：进程在运行时，发生了某种异常时间，使进程无法继续进行。
- 外界干预：指进程应外界的请求而终止运行，如操作员或操作系统干预、父进程请求和父进程终止。

**终止原语**：就绪态/阻塞态/运行态 -> 终止态 -> 无

1. 根据被终止进程的标识符，检索出该进程的 PCB，从中读出该进程的状态。
2. 若被终止进程处于运行状态，立即终止该进程的执行，将 CPU 资源分配给其他进程。
3. 若该进程还有子孙进程，则通常需将其所有子孙进程终止（有些系统无此要求）。
4. 将该进程所拥有的全部资源，或归还给其父进程，或归还给操作系统。
5. 将该 PCB 从所在队列（链表）中删除。

有些系统不允许子进程在父进程终止的情况下存在，对于这类系统，若一个进程终止，则它的所有子进程也终止，这种现象称为**级联终止**。然而不是所有操作系统都是这样设计的。









