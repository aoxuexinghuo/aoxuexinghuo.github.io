---
title: 计算机组成原理 第五章 中央处理器
date: 2025-03-12 19:10:06
category: 计算机组成原理
tags:
- 计算机组成原理
- 笔记
description: 大的药来了。
cover: https://bu.dusays.com/2025/03/12/67d16c3e6dcfc.jpg
series: CS
---

> **🚥计算机组成原理 系列文章导航🚥**
>
> {% series CS %}

## 一、CPU 的功能和基本结构

**CPU 的功能**：

- **指令控制**：完成取指令、分析指令和执行指令的操作，即程序的顺序控制。
- **操作控制**：产生完成一条指令所需的操作信号，把各种操作信号送到相应的部件，从而控制这些部件按指令的要求正确执行。
- **时间控制**：严格控制各种操作信号的出现时间、持续时间及出现的时间顺序。
- **数据加工**：对数据进行算术和逻辑运算。
- **中断处理**：对运行过程中出现的异常情况和终端请求进行处理。

**CPU 的基本结构**：包括运算器和控制器两大部分

**运算器**：对数据进行加工。

- **算术逻辑单元**：主要功能是进行算术/逻辑运算。
- **通用寄存器组**：如 AX、BX、CX、DX、SP 等，用于存放操作数和各种地址信息等。SP 是堆栈指针，用于指示栈顶的地址。
- **暂存器**：用于暂存从主存读来的数据，这个数据不能存放在通用寄存器中，否则会破坏其原有内容。
- **累加寄存器**：它是一个通用寄存器，用于暂时存放 ALU 运算的结果信息，用于实现加法运算。
- **程序状态字寄存器**：PSW 中这些标志位参与并决定微操作的形成。
- **移位器**：对运算结果进行移位运算。
- **计数器**：控制乘除运算的操作步数。

**控制器**：协调并控制计算机各部件执行程序的指令序列，基本功能包括取指令、分析指令、执行指令。 每条指令的执行是由控制器发出的一组微操作实现的。

- **程序计数器**：用于指出下一条指令在主存中的存放地址。CPU 根据 PC 的内容去主存中取指令。因为程序指令中指令通常是顺序执行的，所以 PC 有自增功能
- **指令寄存器**：用于保存当前正在执行的那条指令。
- **指令译码器**：仅对操作字段进行译码，向控制器提供特点的操作信号。
- **微操作信号发生器**：根据 IR 的内容（指令）、PSW 的内容（状态信息）及时序信号，产生控制整个计算机系统所需的各种控制信号，其结构有组合逻辑型和存储逻辑型两种。
- **时序系统**：用于产生各种时序信号，它们都是由统一时钟（CLOCK）分频得到。
- **存储器地址寄存器**：用与存放所要访问的主存单元的地址。
- **存储器数据寄存器**：用于存放向主存写入的信息或从主存中读出的信息。

下图为 **CPU 内部单总线方式**下的结构，其中，橙色标注的为**用户可见的寄存器**，灰色标注的为**用户不可见的寄存器**。

<img src="https://bu.dusays.com/2025/03/15/67d574d372858.png" alt="image-20250314143944129" style="zoom: 50%;" />

## 二、指令执行过程

### 1.指令周期

**指令周期**：CPU 从主存中每取出并执行一条指令所需的全部时间。取值阶段完成取指令和分析指令的操作，也称**取指周期**；执行阶段完成执行指令的操作，也称**执行周期**。

**指令周期**常常用若干**机器周期**来表示，机器周期又叫 **CPU 周期**。

一个**机器周期**又包括若干**时钟周期**（也称为节拍、T 周期或 CPU 时钟周期，是 CPU 操作的**最基本单位**）。

![image-20250314150836418](https://bu.dusays.com/2025/03/15/67d574d8da289.png)

<img src="https://bu.dusays.com/2025/03/15/67d574de89a99.png" alt="image-20250314200226346" style="zoom: 80%;" />

每个指令周期内机器周期数可以不等，每个机器周期内的节拍数也可以不等。

四个工作周期都有 CPU 访存操作，只是访存的目的不同。取指周期是为了取指令，间址周期是为了取有效地址，执行周期是为了取操作数（当指令为访存指令时），中断周期是为了保存程序断点。

> **注意**：早期计算机通常采用机器周期、节拍和脉冲三级时序系统，一个指令可分为取指令、取操作数、执行、中断响应等工作周期，称为机器周期。现在的计算机已不再采用上述三级时序系统，机器周期的概念已逐渐消失，CPU 内部的定时信号就是时钟，一个时钟周期就是一个节拍。

### 2.指令周期的数据流

为了区分 CPU 的四个周期，在 CPU 内部可设置 4 个标志触发器，如下图：

<img src="https://bu.dusays.com/2025/03/15/67d57d7d78b02.png" alt="image-20250315211535512" style="zoom: 67%;" />

图中的 FE（Fetch Execution）、IND（Indirect Addressing）、EX（Execute）、INT（Interrupt）分别对应取指、间址、执行、中断四个周期，并用 1 表示有效。

#### （1）取指周期

取指周期的任务是根据 PC 的内容从主存储器中取出指令代码并存放在 IR 中：

![image-20250315153549832](https://bu.dusays.com/2025/03/15/67d574e28e015.png)

![image-20250315153535261](https://bu.dusays.com/2025/03/15/67d574e5350dd.png)

#### （2）间址周期

间址周期的任务是取操作数的有效地址，需要先判断有没有间址周期，下面以一次间址为例：

![image-20250315152557064](https://bu.dusays.com/2025/03/15/67d574ea1a98c.png)

![image-20250315152225460](https://bu.dusays.com/2025/03/15/67d574edb821a.png)

间址周期的第一步中，IR 和 MDR 两者的内容是一样的，都可以提供指令字的地址字段。

间址周期的最后，将有效地址存放到 MDR 中，但也有的 CPU 会再将有效地址送到指令的地址码字段，记作：(MDR)->Ad(IR)。

#### （3）执行周期

执行周期的任务是取操作数，并根据 IR 中的指令字的操作码通过 ALU 操作产生执行结构。但不同指令的执行周期操作不同，没有统一数据流向。

#### （4）中断周期

中断周期的任务是处理中断请求，假设程序断点存入堆栈中，并用 SP 指示栈顶地址，而且进栈操作是先修改栈顶指针，后存入数据：

![image-20250315152625121](https://bu.dusays.com/2025/03/15/67d574f2b32e5.png)

![image-20250315152327605](https://bu.dusays.com/2025/03/15/67d574f741b91.png)

### 3.指令执行方案

#### （1）单周期处理器

**单周期处理器**对所有指令都选用相同的执行时间来完成。每条指令都在一个时钟周期内完成（CPI = 1），指令之间串行执行；指令周期取决于执行时间最长的指令的执行时间。

对于那些本来可以在更短时间内完成的指令，仍要在这个较长的周期内完成，会降低整个系统的运行速度。

#### （2）多周期处理器

**多周期处理器**对不同类型的指令选用不同的执行步骤，指令需要几个周期就为其分配几个周期，因此可选用不同个数的时钟周期来完成不同指令的执行过程（CPI > 1），不再要求所有指令占用相同的执行时间。多指令周期方案中指令之间仍是**串行**执行的。

#### （3）流水线处理器

**流水线处理器**采用指令直接并行执行的方案，力争在每个时钟周期完成一条指令的执行过程（只能在理想情况下才能达到，此时 CPI = 1）。这种方案通过在每个时钟周期内启动一条指令，尽量让多条指令同时运行，但各自出在不同的执行步骤中（因为指令在不同步骤中要用到的硬件会有所不同）。

## 三、数据通路的功能和基本结构

### 1.数据通路的功能和组成

CPU 可以视为由**数据通路**和**控制部件**两大部分组成。数据在指令执行过程中所经过的路径，包括路径上的部件，称为**数据通路**。数据通路由控制部件控制，控制部件根据每条指令功能的不同，生成对数据通路的控制信号。

组成数据通路的原件主要分为**组合逻辑元件**和**时序逻辑元件**两类：

- **组合逻辑元件**（操作元件）：任何适合产生的输出仅取决于当前的输入。不含存储信号的记忆单元，也不受时钟信号的控制，输入输出之间无反馈通路，数据是单向传输的。常用的有加法器、算术逻辑单元（ALU）、译码器、多路选择器、三态门等。
- **时序逻辑元件**（状态元件）：任何时候的输出不仅与该时刻的输入有关，还与该时刻以前的输入有关，因此时序电路必然包含存储信号的记忆单元。此外还必须在时钟节拍下工作。各类寄存器和存储器都属于时序逻辑单元。

### 2.数据通路的基本结构

#### （1）CPU 内部单总线方式

将 ALU 及所有寄存器都连接到一条内部总线上，称为单总线结构的数据通路。这种结构比较简单，但数据传输存在较多的冲突现象，性能较低。

区分内部总线与系统总线:

- **内部总线**：是指同一台计算机系统的各部件，如 CPU、内存、寄存器及运算部件之间的总线。
- **系统总线**：是指同一台计算机系统的各部件，如 CPU、内存、通道和各类 I/O 接口间互相连接的总线。 

> **注意**：单周期处理器（CPI = 1）不能采用单总线方式，因为单总线将所有寄存器都连接到一条公共总线上，一个时钟周期内只允许一次操作，无法完成一条指令的全部操作。

#### （2）CPU 内部多总线方式

CPU 内部有两条或更多的总线时，构成双总线结构或多总线结构。采用多总线结构可以同时在多个总线上传送不同的数据，提升效率。

#### （3）专用数据通路方式

根据指令执行过程中的数据和地址的流动方向安排连接线路（只要两个寄存器之间需要有数据流动，就专门建立一个连线）。性能高，基本不存在数据冲突，但结构复杂、硬件量大，不易实现。

此外，如果直接用导线连接，相当于多个寄存器同时并且一直向 ALU 传输数据。

- 解决方式 1：使用多路选择器根据控制信号选择一路输出。
- 解决方法 2：使用三态门控制每一路是否输出。

### 3.数据通路的操作举例

总线是一组共享的传输信号线，它不能存储信息，在任一时刻也只能有一个部件把信息送到总线上。下面以单总线数据通路为例介绍常见操作的流程及控制信号：

<img src="https://bu.dusays.com/2025/03/15/67d574fe4a4de.png" alt="image-20250315195047037" style="zoom: 67%;" />

**（1）通用寄存器之间传送数据**

以 PC 为例，将 PC 的内容送至 MAR：

|   微操作    |              控制信号               |
| :---------: | :---------------------------------: |
| (PC) -> MAR | PCout 和 MARin 有效，PC 内容 -> MAR |

**（2）从主存读取数据**

以 CPU 从主存中取指令为例：

|             微操作             |                   控制信号                    |
| :----------------------------: | :-------------------------------------------: |
|          (PC) -> MAR           |   PCout 和 MARin 有效，现行指令地址 -> MAR    |
| MEM(MAR) ->MDR, (PC) + 1 -> PC | MDRinE 有效，CU 发出读命令，取出指令后 PC + 1 |
|          (MDR) -> IR           |      MDRout 和 IRin 有效，现行指令 -> IR      |

**（3）将数据写入主存**

以将寄存器 R1 的内容写入寄存器 R2 所指的主存单元为例：

|     微操作      |          控制信号           |
| :-------------: | :-------------------------: |
|   (R1) -> MDR   |     R1out 和 MDRin 有效     |
|   (R2) -> MAR   |     R2out 和 MARin有效      |
| MDR -> MEM(MAR) | MDRoutE 有效，CU 发出写命令 |

**（4）执行算术或逻辑运算**

ALU 中设置暂缓器的原因：
