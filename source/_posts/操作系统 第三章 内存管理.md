---
title: 操作系统 第三章 内存管理
date: 2025-04-07 14:54:21
category: 操作系统
tags:
  - 操作系统
  - 408
cover: https://bu.dusays.com/2025/03/27/67e5014a4ac08.jpg
series: OS
---

> **🚥操作系统 系列文章导航🚥**
>
> {% series OS %}

## 一、内存管理概念

### 1.内存管理的功能

内存管理的主要功能有：

- **内存空间的分配与回收**。
- **地址转换**。
- **内存空间的扩充**。
- **内存共享**。指允许多个进程访问内存的同一部分。
- **存储保护**。保证各个进程在各自的存储空间内运行，互不干扰。

> **注意**：并不是所有的进程内存都适合共享，只有那些只读的区域才可以共享。**可重入代码**也称**纯代码**，是一种允许多个进程同时访问但不允许被任何进程修改的代码。但在实际执行时，也可为每个进程配以局部数据区，将在执行中可能改变的部分复制到该区域，这样，程序在执行时只需对该私有数据区域中的内存进行修改，并不去改变共享的代码。

### 2.程序的链接与装入

将用户源程序变为可在内存中执行的程序，通常需要以下几个步骤：

- **编译**：由编译程序将用户源代码编译成若干目标模块。
- **链接**：由链接程序将编译后形成的一组目标模块，以及它们所需的库函数链接在一起，形成一个完整的装入模块。
- **装入**：由装入程序将装入模块装入内存运行。

<img src="https://bu.dusays.com/2025/04/08/67f4d5bae1adc.png" alt="image-20250408151348813" style="zoom:67%;" />

将一个装入模块装入内存时，有以下三种装入方式：

**（1）绝对装入**（单道程序阶段，无操作系统）

**绝对装入**方式只适用于**单道程序环境**。在编译时，若知道程序将放到内存的哪个位置，则**编译程序**将产生绝对地址的目标代码。

装入程序按照装入模块中的地址，将程序和数据装入内存。程序中的逻辑地址与实际地址完全相同，因此不需对程序和数据的地址进行修改。

**（2）可重定位装入**（早期多道批处理阶段）

**可重定位装入**也称**静态重定位**。经过编译、链接后的装入模块的地址都是从 0 开始的，指令中使用的地址、数据存放的地址都是相对于起始地址而言的逻辑地址。可根据内存的当前情况，将装入模块装入到内存的适当位置。装入时对地址进行**重定位**，将逻辑地址变换为物理地址（地址变换是在**装入时一次完成**的）。

**特点**：是在一个作业装入内存时，**必须分配其要求的全部内存空间**，如果没有足够的内存，就不能装入该作业。作业一旦进入内存，整个运行期间就**不能在内存中移动**，也不能再申请内存空间。

**（3）动态运行时装入**（现代操作系统）

**动态运行时装入**也称**动态重定位**。经过编译、链接后的装入模块的地址都是从 0 开始的。装入程序把装入模块装入内存后，并不会立即把逻辑地址转换为物理地址，而是**把地址转换推迟到程序真正要执行时才进行**。因此装入内存后的所有的地址依然是逻辑地址。这种方式需要一个**重定位寄存器**（存放装入模块的起始位置）的支持。

**优点**：①可以将程序分配到不连续的存储区。②在程序运行前只需装入它的部分代码即可投入运行，然后在程序运行期间，根据需要动态申请分配内存。③便于程序段的共享。

对目标模块进行连接时，根据链接的时间不同，分为三种连接方式：

- **静态链接**：在程序运行之前，先将各目标模块及它们所需的库函数连接成一个完整的可执行文件（装入模块），之后不再拆开。
- **装入时动态链接**：将各目标模块装入内存时，采用边装入边链接的方式。其优点是便于修改和更新，便于实现对目标模块的共享。
- **运行时动态链接**：在程序执行中需要某目标模块时，才对它进行链接。凡在程序执行中未用到的目标模块，都不会被调入内存和链接到装入模块上。其优点是能加快程序的装入过程，还可节省内存空间。

> **疑惑**：在看王道视频时，咸鱼把便于修改和更新、便于实现对目标模块的共享归为运行时动态链接的优点，而王道书上却把其归为装入时动态链接的优点。Deepseek 给出的答案则是为前者：
>
> |       **特性**       |      **运行时动态链接**      |     **装入时动态链接**     |     **静态链接**     |
> | :------------------: | :--------------------------: | :------------------------: | :------------------: |
> | **修改和更新便利性** |      高（无需重启程序）      |    中（需重新装入程序）    | 低（需重新编译程序） |
> |   **模块共享能力**   | 高（多进程共享同一物理内存） | 中（依赖操作系统内存管理） |  无（代码重复嵌入）  |

### 3.存储保护

内存保护可采取两种方法：

**方法一**：在 CPU 中设置一对**上、下限寄存器**，存放用户进程在主存中的上、下限地址。每当 CPU 要访问一个地址时，分别和两个寄存器的值相比，判断有无越界。

<img src="https://bu.dusays.com/2025/04/08/67f503d005c88.png" alt="image-20250408190143223" style="zoom: 67%;" />

**方法二**：采用**重定位寄存器**（也称**基地址寄存器**）和**界地址寄存器**（也称**限长寄存器**）进行越界检测。重定位寄存器中存放的是进程的起始物理地址，界地址寄存器中存放的时进程的最大逻辑地址。内存管理部件将逻辑地址与界地址寄存器进行比较，若未发生地址越界，则加上重定位寄存器的值后映射成物理地址，再交送内存单元。

<img src="https://bu.dusays.com/2025/04/08/67f503d61c262.png" alt="image-20250408145445690" style="zoom:50%;" />

加载重定位寄存器和界地址寄存器时必须使用**特权指令**，只有**操作系统内核**才可以加载这两个寄存器。

## 二、连续分配管理方式
